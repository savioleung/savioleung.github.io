---
layout: post
title: Infinity Great War[C#,Unity]
categories: [C#,Unity]
tags: []
description: ! 無限に遊べるタワーディフェンス
---
タイトル：Infinity Great War

制作期間:2018/4~2018/4 約15時間

製作人数：1人

コンセプト：無限に遊べるタワーディフェンス

Github:[Infinity Great War](https://github.com/savioleung/Infinity-Great-War)

動画：

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_1.png)

説明：

スマホゲームを一つ自由に作る課題を受け、製作した作品です。

最もやりたい事は2本の指で2つの砲台を別々にコントロールするタワーディフェンスゲームを作りたい、

そして負け、強化して、どんどん強くなって、終わりのないゲームにしたい。

<details>
    <summary>＋プレイヤーがコントロールする砲台のプログラム</summary>
    {% highlight csharp %}
void gunControl()
{
    cdd += 1 * Time.deltaTime;
    if (cdd >= cd)
    {
        cdd = 0;
        GameObject clone = Instantiate(bullet, new Vector3(bp.transform.position.x, bp.transform.position.y, bp.transform.position.z - 10), transform.rotation) as GameObject;

        //clone.transform.parent = this.transform;
        Destroy(clone, 3);
        GameObject clone2 = Instantiate(bullet, new Vector3(bp2.transform.position.x, bp2.transform.position.y, bp2.transform.position.z - 10), transform.rotation) as GameObject;
        Destroy(clone2, 3);
    }
#if UNITY_EDITOR
    Vector3 norTar = (Camera.main.ScreenToWorldPoint(Input.mousePosition) - transform.position).normalized;
    float angle = Mathf.Atan2(norTar.y, norTar.x) * Mathf.Rad2Deg;

    Quaternion rotation = new Quaternion();
    rotation.eulerAngles = new Vector3(0, 0, angle - 90);
    transform.rotation = rotation;
#else　//スマホの場合
		Touch myTouch = Input.GetTouch(0);
		Touch[] myTouches = Input.touches;
		for (int i = 0; i < Input.touchCount; i++) {
			if (Input.touchCount <= 1|| this.tag=="gun") {
				if (Input.touches [0].phase == TouchPhase.Began || Input.touches [0].phase == TouchPhase.Moved) {
					Vector2 norTar = (Camera.main.ScreenToWorldPoint (Input.touches [0].position) - transform.position).normalized;
					float angle = Mathf.Atan2 (norTar.y, norTar.x) * Mathf.Rad2Deg;

					Quaternion rotation = new Quaternion ();
					rotation.eulerAngles = new Vector3 (0, 0, angle - 90);
					transform.rotation = rotation;
				}
			}
			if (this.tag == "gun2") {
				if (Input.touches [1].phase == TouchPhase.Began || Input.touches [1].phase == TouchPhase.Moved) {
					Vector2 norTar = (Camera.main.ScreenToWorldPoint (Input.touches [1].position) - transform.position).normalized;
					float angle = Mathf.Atan2 (norTar.y, norTar.x) * Mathf.Rad2Deg;

					Quaternion rotation = new Quaternion ();
					rotation.eulerAngles = new Vector3 (0, 0, angle - 90);
					transform.rotation = rotation;
				}
			}
			}
#endif
}
{% endhighlight %}
</details>

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_2.png)
![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_3.png)

敵のプログラムはシンプルに外部から最初にステイタス設定出来る様にして、そこをいじれば違うタイプの敵が出来る、

動作としても前進、砲台の弾に当たれば自分のHPを減らす、後はプレイヤーが守る壁に当たれば高速回転して消える、攻撃成功の印。

<details>
    <summary>＋敵プログラム</summary>
{% highlight csharp %}
Rigidbody2D body;
	public float speed=1,hp=100f,atk=5;

	public int getGold = 1;
	bool hit=false;
	// Use this for initialization
	void Start () {
		body = GetComponent<Rigidbody2D> ();


	}
	void Update(){
		body.velocity = transform.right * -speed;
		if (hp <= 0) {
			
			Destroy (this.gameObject);
		}
		if (hit) {
			body.velocity = Vector3.zero;
			transform.Rotate(Vector3.back *(3600* Time.deltaTime), Space.World);
		}

	}

	void OnTriggerEnter2D(Collider2D other){
		if (other.gameObject.tag == "bullet") {
			hp -= other.GetComponent<bullet> ().atk;
			Destroy (other.gameObject);
		} else if (other.gameObject.tag == "bullet_s") {
			
			hp -= other.GetComponent<bullet> ().atk;

		}else if(other.gameObject.tag!="enemy") {
			hit = true;
		}
{% endhighlight %}

</details>

敵は赤、黄、緑の3タイプとボスがあります、

赤は1ウェーブから出現、一般的な敵

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_9.png)

黄色は11ウェーブから出現、素早いが脆い特攻兵

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_11.png)

緑は21ウェーブから出現、移動は遅いですが、固いかつ攻撃も高い重装兵

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_12.png)

そして最後にボスがあります、ボスは50ウェーブの度に出現、

50ウェーブの度に数が増える、50ウェーブなら1体、100ウェーブなら2体、

更にボスには雑魚敵の生成能力があります、1秒の度にランダムに雑魚を生成します

<details>
    <summary>＋雑魚生成プログラム</summary>
    {% highlight csharp %}
void zakoSpawn()
{
	cdd += 1 * Time.deltaTime;
	if (cdd >= cd)
	{
		cdd = 0;
		int b = Random.Range(1, 4);
		if (b == 1)
		{
			Instantiate(en1, e1.transform.position, Quaternion.identity);
		}
		if (b == 2)
		{
			Instantiate(en2, e2.transform.position, Quaternion.identity);
		}
		if (b == 3)
		{
			Instantiate(en3, e3.transform.position, Quaternion.identity);
		}
	}
}
{% endhighlight %}
</details>

敵はウェーブが進む度にランダムに敵の総数を1から3増えまして、敵の生成もランダムに3タイプから生成される。

<details>
    <summary>＋敵生成プログラム</summary>
    {% highlight csharp %}
void enemySpawn()
{
	if (game)
	{
		GameObject[] enemys = GameObject.FindGameObjectsWithTag("enemy");
		if (enemys.Length <= 0)
		{
			w++;

			enemyNo += Random.Range(1, 3);
			x += Random.Range(2, 4);
			if ((w % 50) == 0)
			{
				for (int i = 0; i < bs; i++)
				{
					Instantiate(boss, new Vector3(Random.Range(16, 16 + (9 * bs)), 0, -100), Quaternion.identity);

				}
				bs++;

			}
			else
			{
				for (int i = 0; i < enemyNo; i++)
				{
					if (w <= 10)
					{
						Instantiate(enemy1, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);


					}
					else if (w <= 20)
					{
						int b = Random.Range(1, 3);
						if (b == 1)
						{
							Instantiate(enemy1, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);
						}
						if (b == 2)
						{
							Instantiate(enemy2, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);
						}

					}
					else
					{
						int b = Random.Range(1, 4);
						if (b == 1)
						{
							Instantiate(enemy1, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);
						}
						if (b == 2)
						{
							Instantiate(enemy2, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);
						}
						if (b == 3)
						{
							Instantiate(enemy3, new Vector3(Random.Range(14.0f, x), Random.Range(-6.0f, 6.0f), -100), Quaternion.identity);
						}
					}
				}
			}
		}


		enetxt.text = "Enemy:" + enemys.Length.ToString();
		for (int i = 0; i < enemys.Length; i++)
		{
			if (enemys[i].GetComponent<enemy>().hp <= 0)
			{
				g += enemys[i].GetComponent<enemy>().getGold;

			}
		}
	}
}
{% endhighlight %}
</details>

プレイヤーの対抗手段は自分の砲台のみならず、敵を倒して手に入れたいゴールドで3つの機能が使える。

一つ目は回復

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_6.png)<br>

50ゴールドで全回復出来る


二つ目はオート砲台を呼び出す


![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_8.png)<br>
20ゴールドでオート砲台スペースにランダムの位置に3タイプの砲台をランダムに配置出来る、

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_5.png)<br>
![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_13.png)

3タイプの砲台：

1つ目：単式砲台、特徴なし

2つ目：三方向式砲台、三つの方向に小さい弾を撃つ、威力低い

3つ目：スナイパー砲台、高威力、貫通弾を撃つ

アンバランスな砲台ランダムに出すのは運要素

最後の機能は強化

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_7.png)<br>

![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_10.png)

自分の砲台を強化出来る、

50ゴールドを使って、攻撃上げる、もしくはリロード秒数を下げる（連射力上がる）

基本的に無限に上がれる


![igw](https://raw.githubusercontent.com/savioleung/savioleung.github.io/master/images/igw/igw_14.png)

最後に、ゴールドは引き続きされる、負けても、ゲーム落ちてもセーブされる。
